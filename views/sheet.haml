%form#sheetform(method="post" action="")
   %h1
      %input#sheet_name{:type => "text", :value => "#{sheet.sheet_name}"}/
   
   .gridcontainer#mygrid(style="width:100%;height:400px;")
   
   %input#savebtn(type="button" value="Save")
   .status
   .results


   %script{:src  => "/js/jquery-1.6.2.min.js"}
   %script{:src  => "/js/jquery-ui-1.8.16.custom.min.js"}
   %script{:src  => "/js/jquery.event.drag-2.0.min.js"}
   %script{:src  => "/grid/slick.core.js"}
   %script{:src  => "/grid/grideditors.js"}
   %script{:src  => "/grid/slick.grid.js"}

   :coffee
      sheet = #{fix_sheet_for_clientside(sheet)}
      # updateSheetField
      options = 
         editable: true,
         autoEdit: true,
         asyncEditorLoading: false,
         enableCellNavigation: true,
         enableColumnReorder: false
      cols = for index, col of sheet["columns"]
         col.editor = TextCellEditor
      grid = new Slick.Grid("#mygrid", sheet["rows"], sheet["columns"], options)
      
      updateSheetName = ->
         sheet.sheet_name = $("#sheet_name").val()
         # throw sheet
      
      successfulSave = (data, textStatus, jqXHR) ->
         sheet = data
         $(".status").empty().append(textStatus)
         # $(".results").empty().append(data)
         # throw jqXHR
      
      saveSheet = -> 
         cols = for index, col of sheet["columns"]
            col.editor = null
         # $(".results").load '/shts/'+sheet.id, sheet, successfulSave
         $.ajax({ type: 'POST', url: '/shts/'+sheet.id, data: sheet, success: successfulSave })
         # throw $("#sheetform")
      
      $("#sheet_name").bind("change", updateSheetName)
      $("#savebtn").bind("click", saveSheet)




- if webdebug?
   .debuggystuff
      %br/
      %br/
      %hr/
      %b params
      = debug(params)
      %br/
      %b sheet
      = debug(sheet) 
      %br/
      %hr/
      %b sheet json
      = sheet.to_json
